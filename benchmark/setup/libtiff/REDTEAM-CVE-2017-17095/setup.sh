#!/bin/bash
BUG_DIR=/data/vulnloc/libtiff/REDTEAM-CVE-2017-17095
PROJECT_URL=https://github.com/vadz/libtiff.git
BUG_COMMIT_ID=070abb3a

mkdir -p ${BUG_DIR}
pushd ${BUG_DIR}

git clone ${PROJECT_URL} src
pushd src
git checkout ${BUG_COMMIT_ID}

./configure --enable-static --disable-shared

sed -i '121d;227d;265d' libtiff/tif_jpeg.c
sed -i '153d;2478d' libtiff/tif_ojpeg.c
git add libtiff/tif_ojpeg.c libtiff/tif_jpeg.c
git commit -m 'remove longjmp calls'