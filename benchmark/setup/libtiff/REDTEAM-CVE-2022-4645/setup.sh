#!/bin/bash
BUG_DIR=/data/vulnloc/libtiff/REDTEAM-CVE-2022-4645
PROJECT_URL=https://github.com/vadz/libtiff.git
BUG_COMMIT_ID=36511f8

mkdir -p ${BUG_DIR}
pushd ${BUG_DIR}

git clone ${PROJECT_URL} src
pushd src
git checkout ${BUG_COMMIT_ID}

# see #62
find tools -name "*.c" | xargs -n1 sed -i 's@"tif_config.h"@"../libtiff/tif_config.h"@g'
find tools -name "*.c" | xargs -n1 sed -i 's@"tiffio.h"@"../libtiff/tiffio.h"@g'
find tools -name "*.h" | xargs -n1 sed -i 's@"tif_config.h"@"../libtiff/tif_config.h"@g'
sed -i 's@"tiffio.h"@"./tiffio.h"@g' libtiff/tiffio.h
sed -i 's@"tiffvers.h"@"./tiffvers.h"@g' libtiff/tiffio.h
sed -i 's@"tiffio.h"@"./tiffio.h"@g' libtiff/tiffiop.h
git add libtiff/*.h tools/*.c tools/*.h
git commit -m "resolve ambiguity in includes"

./configure --enable-static --disable-shared
